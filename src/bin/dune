(executable
 (name deku_node)
 (public_name deku-node)
 (libraries
  dream
  bin_common
  node
  helpers
  cmdliner
  consensus_contract_interop_impl)
 (modules Deku_node)
 (preprocess
  (pps ppx_deriving.show ppx_deriving_yojson ppx_let_binding)))

(executable
 (name sidecli)
 (libraries node bin_common helpers cmdliner consensus_contract_interop_impl)
 (modules Sidecli)
 (public_name sidecli)
 (preprocess
  (pps ppx_deriving_yojson ppx_let_binding)))

(library
 (name bin_common)
 (modules Files Node_state)
 (libraries lwt lwt.unix node helpers)
 (preprocess
  (pps ppx_deriving_yojson ppx_let_binding)))

(env
 (static
  (flags
   (:standard
    -O2
    -ccopt
    -static
    -ccopt
    %{env:CFLAGS=/lib}
    -cclib
    -L%{env:LD_LIBRARY_PATH=/lib}))))
